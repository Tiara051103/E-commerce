<div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg overflow-hidden">

  <!-- ================= TABLE ================= -->
  <table class="w-full text-sm">
    <thead class="bg-slate-100 dark:bg-slate-700">
      <tr>
        <th class="px-4 py-3 text-center">
          <input
            type="checkbox"
            id="check-all"
            class="w-4 h-4 text-blue-600 rounded"
          >
        </th>
        <th class="p-4 text-left">Produk</th>
        <th class="p-4 text-center">Harga</th>
        <th class="p-4 text-center">Jumlah</th>
        <th class="p-4 text-center">Total</th>
        <th class="p-4 text-center">Aksi</th>
      </tr>
    </thead>

    <tbody class="divide-y dark:divide-slate-700">
    {% for item in cart.items %}
      <tr class="hover:bg-slate-50 dark:hover:bg-slate-700 transition">

        <!-- checkbox -->
        <td class="px-4 py-3 text-center">
          <input
            type="checkbox"
            class="item-checkbox w-4 h-4 text-blue-600 rounded"
            data-harga="{{ item.harga_satuan }}"
            data-jumlah="{{ item.jumlah }}"
          >
        </td>

        <!-- produk -->
        <td class="p-4 font-medium">
          {{ item.nama_produk }}
        </td>

        <!-- harga -->
        <td class="p-4 text-center">
          Rp {{ "{:,}".format(item.harga_satuan) }}
        </td>

        <!-- jumlah -->
        <td class="p-4 text-center">
          <div class="inline-flex items-center gap-2">

            <!-- kurang -->
            <form method="POST" action="{{ url_for('cart.ubah_jumlah_item') }}">
              <input type="hidden" name="id_produk" value="{{ item.id_produk }}">
              <input type="hidden" name="jumlah" value="{{ item.jumlah - 1 }}">
              <button
                type="submit"
                class="w-8 h-8 rounded-full bg-slate-200 hover:bg-slate-300">
                −
              </button>
            </form>

            <span class="w-8 text-center font-semibold">
              {{ item.jumlah }}
            </span>

            <!-- tambah -->
            <form method="POST" action="{{ url_for('cart.ubah_jumlah_item') }}">
              <input type="hidden" name="id_produk" value="{{ item.id_produk }}">
              <input type="hidden" name="jumlah" value="{{ item.jumlah + 1 }}">
              <button
                type="submit"
                class="w-8 h-8 rounded-full bg-emerald-500 text-white hover:bg-emerald-600">
                +
              </button>
            </form>

          </div>
        </td>

        <!-- total -->
        <td class="p-4 text-center font-semibold">
          Rp {{ "{:,}".format(item.harga_satuan * item.jumlah) }}
        </td>

        <!-- hapus -->
        <td class="p-4 text-center">
          <form method="POST"
                action="{{ url_for('cart.hapus_item', id_produk=item.id_produk) }}"
                onsubmit="return confirm('Hapus item ini?')">
            <button
              type="submit"
              class="w-8 h-8 rounded-full bg-rose-500 text-white hover:bg-rose-600">
              ✕
            </button>
          </form>
        </td>

      </tr>
    {% endfor %}
    </tbody>
  </table>

  <!-- ================= FOOTER (WAJIB DI LUAR TABLE) ================= -->
  <div class="p-4 border-t dark:border-slate-700">
    <a href="{{ url_for('produk.daftar_produk') }}"
       class="text-sm text-emerald-600 hover:underline">
      ← Kembali Belanja
    </a>
  </div>

</div>

<!-- ================= JAVASCRIPT ================= -->
<script>
function updateRingkasan() {
  let totalItem = 0;
  let totalHarga = 0;

  document.querySelectorAll(".item-checkbox:checked").forEach(cb => {
    const harga = parseInt(cb.dataset.harga);
    const jumlah = parseInt(cb.dataset.jumlah);

    totalItem += jumlah;
    totalHarga += harga * jumlah;
  });

  const totalItemEl = document.getElementById("totalItem");
  const totalHargaEl = document.getElementById("totalHarga");

  if (totalItemEl) totalItemEl.innerText = totalItem;
  if (totalHargaEl)
    totalHargaEl.innerText = "Rp " + totalHarga.toLocaleString("id-ID");
}

const checkAll = document.getElementById("check-all");
const itemCheckboxes = document.querySelectorAll(".item-checkbox");

// SELECT ALL
if (checkAll) {
  checkAll.addEventListener("change", function () {
    itemCheckboxes.forEach(cb => cb.checked = this.checked);
    updateRingkasan();
  });
}

// ITEM SATUAN
itemCheckboxes.forEach(cb => {
  cb.addEventListener("change", function () {
    if (checkAll) {
      checkAll.checked =
        document.querySelectorAll(".item-checkbox:checked").length ===
        itemCheckboxes.length;
    }
    updateRingkasan();
  });
});
</script>
